<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Detail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4">Request Detail - ID <%= request.id %></h1>

    <!-- اطلاعات درخواست -->
    <div class="card mb-4">
        <div class="card-body">
            <p><strong>Citizen:</strong> <%= request.citizen_name %></p>
            <p><strong>Service:</strong> <%= request.service_name %></p>
            <p><strong>Status:</strong> <span id="request-status"><%= request.status %></span></p>
            <p><strong>Submitted On:</strong> <%= request.created_at.toLocaleDateString() %></p>
        </div>
    </div>

    <!-- مدارک درخواست با پیش‌نمایش -->
    <h4>Documents</h4>
    <div id="documents" class="mb-4">
        <% request.documents.forEach(doc => { 
            const ext = doc.split('.').pop().toLowerCase();
        %>
            <div class="mb-2">
                <% if (["jpg","jpeg","png","gif"].includes(ext)) { %>
                    <img src="/uploads/<%= doc %>" alt="<%= doc %>" class="img-thumbnail" style="max-width:200px;">
                <% } else if (ext === "pdf") { %>
                    <iframe src="/uploads/<%= doc %>" style="width:100%;height:400px;" frameborder="0"></iframe>
                <% } else { %>
                    <a href="/uploads/<%= doc %>" target="_blank"><%= doc %></a>
                <% } %>
            </div>
        <% }) %>
    </div>

    <!-- دکمه‌ها -->
    <a href="/officer/dashboard" class="btn btn-secondary">Back to Dashboard</a>
    <button id="approve-btn" class="btn btn-success">Approve</button>
    <button id="reject-btn" class="btn btn-danger">Reject</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const requestId = "<%= request.id %>";

    document.getElementById('approve-btn').addEventListener('click', () => {
        fetch(`/officer/requests/${requestId}/approve`, { method: 'POST' })
            .then(res => res.json())
            .then(data => {
                document.getElementById('request-status').textContent = data.status;
                alert('Request approved!');
            })
            .catch(err => console.error(err));
    });

    document.getElementById('reject-btn').addEventListener('click', () => {
        fetch(`/officer/requests/${requestId}/reject`, { method: 'POST' })
            .then(res => res.json())
            .then(data => {
                document.getElementById('request-status').textContent = data.status;
                alert('Request rejected!');
            })
            .catch(err => console.error(err));
    });
</script>
</body>
</html>
